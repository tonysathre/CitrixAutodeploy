name: CI

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  install-prereqs:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - run: ${{ github.workspace }}/install-prereqs.ps1 -Verbose -Force
        shell: powershell
      # TODO(tonysathre): Need to test removing this step
      - run: $env:PSModulePath = [System.Environment]::GetEnvironmentVariable("PSModulePath", "Machine") + ";" + [System.Environment]::GetEnvironmentVariable("PSModulePath", "User")
        shell: powershell

      - run: |
          Import-Module ${{github.workspace}}/module/CitrixAutodeploy/CitrixAutodeploy.psd1
          get-module citrix* -ListAvailable
          Initialize-CtxAutodeployEnv
        shell: powershell

#  build-module:
#      runs-on: windows-latest
#      strategy:
#        matrix:
#          pwsh-version: ['7.3.12', '7.2.23']
#      steps:
#        - uses: actions/checkout@v4
#        - name: Setup PowerShell
#          uses: microsoft/setup-powershell@v1
#          with:
#            pwsh-version: '7.3.12'

